<EditableChip>:
    orientation: 'horizontal'
    size_hint: None, None
    height: dp(28)
    width: dp(36) + chip_label.texture_size[0]
    padding: [dp(8), dp(4), dp(6), dp(4)]
    spacing: dp(6)
    state: close_button.state
    pos_hint: {'center_y': 0.5, 'center_x': 0.5}

    canvas.before:
        Color:
            rgba: white if self.state == 'normal' else destructive_color
        SmoothRoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(4)]
        Color:
            rgba: border_color
        SmoothLine:
            rounded_rectangle: (*self.pos, *self.size, dp(4))
    
    Label:
        id: chip_label
        text: root.text
        font_size: font_size_xs
        bold: True
        color: muted_foreground_color
        size_hint: None, None
        size: [self.texture_size[0], dp(20)]

    Button:
        id: close_button
        text: unicode['close']
        font_name: icon_font
        size_hint: None, None
        size: [dp(16), dp(16)]
        background_color: transparent
        color: muted_foreground_color
        font_size: font_size_base
        pos_hint: {'center_y': 0.5}
        on_release: root.dispatch('on_remove')


<BoxChipInput>:
    orientation: 'vertical'
    size_hint_y: None
    height: self.minimum_height
    spacing: dp(8)
    text_input: text_input.__self__
    
    # Text input at the top using TextField
    TextField:
        id: text_input
        hint_text: root.placeholder
        on_text_validate: root.add_value(self.text)
    
    # Box container with chips (similar to built-in exclusions)
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: dp(100) if root.values else dp(60)
        padding: dp(12)
        
        canvas.before:
            Color:
                rgba: muted_color
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [dp(6)]

        Widget:
        
        # Show placeholder text when empty
        Label:
            text: 'No patterns added yet. Type above and press Enter to add patterns.' if not root.values else ''
            font_size: font_size_xs
            color: muted_foreground_color
            opacity: 1 if not root.values else 0
            size_hint: None, None
            size: self.texture_size
            pos_hint: {'center_x': 0.5}

        # RecycleView for chips
        RecycleView:
            data: [{'text': pattern, 'on_remove': lambda p=pattern: root.remove_value(p)} for pattern in root.values]
            size_hint_y: None
            height: dp(72) if root.values else 0
            viewclass: 'EditableChip'
            opacity: 1 if root.values else 0
            # effect_cls: 'ScrollEffect'

            RecycleGridLayout:
                default_size: None, dp(28)
                default_size_hint: None, None
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(6)
                padding: [dp(4), dp(4)]
                orientation: 'lr-tb'
                cols: max(1, int(self.width / dp(120)))

        Widget: